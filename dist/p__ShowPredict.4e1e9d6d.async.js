(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[591],{16570:function(Oe,I,t){"use strict";t.r(I);var Ue=t(49111),y=t(19650),Y=t(34669),c=t(32074),S=t(48736),g=t(27049),B=t(57663),E=t(71577),m=t(86582),C=t(12968),F=t(62462),Ot=t(34792),v=t(48086),T=t(3182),n=t(2824),Ut=t(43185),Ie=t(11324),Se=t(94043),P=t.n(Se),a=t(67294),R=t(3843),Be=t(45510),D=t(57895),Fe=t(27484),$=t.n(Fe),b=t(21010),G=t(43642),Re=t(90631),Q=t(43347),p=t(75297),X=t(64172),e=t(85893),H=Ie.Z.Dragger,Ze=function(){var Le=(0,a.useState)([]),J=(0,n.Z)(Le,2),je=J[0],We=J[1],ye=(0,a.useState)([]),k=(0,n.Z)(ye,2),Te=k[0],be=k[1],Ke=(0,a.useState)([]),q=(0,n.Z)(Ke,2),Z=q[0],ee=q[1],xe=(0,a.useState)([]),te=(0,n.Z)(xe,2),L=te[0],ae=te[1],ze=(0,a.useState)(0),re=(0,n.Z)(ze,2),Ne=re[0],we=re[1],Ve=(0,a.useState)(0),ue=(0,n.Z)(Ve,2),Ye=ue[0],$e=ue[1],Ge=(0,a.useState)(""),se=(0,n.Z)(Ge,2),Qe=se[0],Xe=se[1],He=(0,a.useState)(""),ne=(0,n.Z)(He,2),Je=ne[0],ke=ne[1],qe=(0,a.useState)(!1),le=(0,n.Z)(qe,2),de=le[0],et=le[1],tt=(0,a.useState)(0),ie=(0,n.Z)(tt,2),St=ie[0],at=ie[1],rt=(0,a.useState)(""),oe=(0,n.Z)(rt,2),Bt=oe[0],ut=oe[1],st=(0,a.useState)(!1),_e=(0,n.Z)(st,2),fe=_e[0],K=_e[1],nt=(0,a.useState)(0),ce=(0,n.Z)(nt,2),pe=ce[0],x=ce[1],lt=(0,a.useState)([]),me=(0,n.Z)(lt,2),dt=me[0],it=me[1],ot=(0,a.useState)([]),De=(0,n.Z)(ot,2),_t=De[0],ft=De[1],ct=(0,a.useState)(void 0),Ee=(0,n.Z)(ct,2),pt=Ee[0],mt=Ee[1],Dt=(0,a.useState)(!1),ve=(0,n.Z)(Dt,2),Et=ve[0],z=ve[1],vt=(0,a.useState)(!1),Pe=(0,n.Z)(vt,2),ge=Pe[0],N=Pe[1],w=(0,b.YB)(),V=(0,a.useRef)(),Ce=(0,a.useRef)(),M=(0,a.useRef)(void 0),j=(0,a.useRef)(0),Me=(0,b.tT)("patient"),Pt=Me.getPatientID,gt=Me.getPatientData,h=Pt(),he=gt(),Ct=(0,a.useCallback)(function(){M.current||(M.current=setInterval(function(){pe<=98?(j.current=Math.floor((j.current+Math.random())*100)/100,x(j.current)):clearInterval(M.current)},1e3))},[]),Mt=function(){var o=(0,T.Z)(P().mark(function u(l){var s,f;return P().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return x(0),j.current=0,K(!0),Ct(),r.prev=4,r.next=7,(0,X.Xh)({adc_file:Qe,backmodel:"0",dwi_file:Je,patientID:h,timestamp:V.current});case 7:if(s=r.sent,M.current&&clearInterval(M.current),K(!1),x(100),K(!1),s.data.status!=="success"){r.next=22;break}return it((0,p.U)(s,"data.data.nonperf_res_imgs",[])),ft((0,p.U)(s,"data.data.perf_res_imgs",[])),ut((0,p.U)(s,"data.data.info","")),at((0,p.U)(s,"data.data.size",0)),mt((0,p.U)(s,"data.data.resultID",0)),l.onSubmit(),r.abrupt("return",!0);case 22:return f=w.formatMessage({id:"app.error.network",defaultMessage:"\u7F51\u7EDC\u8FDE\u63A5\u9519\u8BEF\uFF01"}),v.default.error(f),r.abrupt("return",!1);case 25:r.next=32;break;case 27:return r.prev=27,r.t0=r.catch(4),v.default.error("\u7F51\u7EDC\u9519\u8BEF\uFF01"),console.log(r.t0),r.abrupt("return",!1);case 32:case"end":return r.stop()}},u,null,[[4,27]])}));return function(l){return o.apply(this,arguments)}}(),W=function(u){if(u.length!==0)return(0,e.jsx)(F.Z.PreviewGroup,{children:u.map(function(l,s){return(0,e.jsx)(F.Z,{src:l,alt:"",height:"160px",width:"160px"},s)})})},Ae=function(u,l){return l==="ADC"&&ee([].concat((0,m.Z)(Z),[u])),l==="DWI"&&ae([].concat((0,m.Z)(L),[u])),!1},ht=function(){var o=(0,T.Z)(P().mark(function u(l){var s,f,_,r,A,i;return P().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return et(!0),z(!0),V.current=Ce.current.getFieldValue("date").valueOf(),s=new FormData,Z.forEach(function(O){s.append("file",O),s.append("patientID",h),s.append("type","ADC")}),f=new FormData,L.forEach(function(O){f.append("file",O),f.append("patientID",h),f.append("type","DWI")}),d.prev=7,d.next=10,Promise.all([G.$.post("/imgUpload",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(U){we(U.loaded/U.total*100|0)}}),G.$.post("/imgUpload",f,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(U){$e(U.loaded/U.total*100|0)}})]);case 10:if(_=d.sent,r=_[0],A=_[1],!(r.data.status==="success"&&A.data.status==="success")){d.next=24;break}return We((0,p.U)(r,"data.data.imgs",[])),Xe((0,p.U)(r,"data.data.filename",[])),be((0,p.U)(A,"data.data.imgs",[])),ke((0,p.U)(A,"data.data.filename",[])),v.default.success("\u4E0A\u4F20\u6210\u529F\uFF01"),z(!1),l.onSubmit(),d.abrupt("return",!0);case 24:return v.default.error("\u7F51\u7EDC\u9519\u8BEF\uFF01\u8BF7\u7A0D\u540E\u91CD\u8BD5\uFF01"),z(!1),d.abrupt("return",!1);case 27:d.next=35;break;case 29:return d.prev=29,d.t0=d.catch(7),console.log(d.t0),i=w.formatMessage({id:"app.error.network",defaultMessage:"\u7F51\u7EDC\u8FDE\u63A5\u9519\u8BEF\uFF01"}),v.default.error(i),d.abrupt("return",!1);case 35:case"end":return d.stop()}},u,null,[[7,29]])}));return function(l){return o.apply(this,arguments)}}(),At=function(){var o=(0,T.Z)(P().mark(function u(){var l,s,f,_,r;return P().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return N(!0),i.prev=1,i.next=4,(0,X.QL)({resultID:pt});case 4:l=i.sent,s=new Blob([l.data],{type:"application/pdf"}),f=URL.createObjectURL(s),_=document.createElement("a"),_.style.display="none",_.href=f,_.download="\u8F85\u52A9\u8BCA\u65AD\u62A5\u544A-".concat(he.name,"-").concat($()(V.current).format("YYYY-MM-DD")),document.body.appendChild(_),_.click(),document.body.removeChild(_),N(!1),i.next=23;break;case 17:i.prev=17,i.t0=i.catch(1),N(!1),r=w.formatMessage({id:"app.error.network",defaultMessage:"\u7F51\u7EDC\u8FDE\u63A5\u9519\u8BEF\uFF01"}),v.default.error(r),console.log(i.t0);case 23:case"end":return i.stop()}},u,null,[[1,17]])}));return function(){return o.apply(this,arguments)}}();return(0,a.useEffect)(function(){h||b.m8.push("/list")},[h]),(0,e.jsx)(D.ZP,{title:"\u65B0\u5EFA\u6A21\u578B\u9884\u6D4B",extra:"\u5F53\u524D\u75C5\u4EBA:  ".concat(he.name),children:(0,e.jsxs)(R.Z,{formRef:Ce,formProps:{validateMessages:{required:"\u6B64\u9879\u4E3A\u5FC5\u586B\u9879"}},submitter:{render:function(u){var l=u.step;if(l===0)return(0,e.jsx)(D.ZP,{children:(0,e.jsx)(E.Z,{type:"primary",onClick:function(){return ht(u)},disabled:Z.length!==1||L.length!==1,loading:Et,children:"\u4E0A\u4F20\u6570\u636E"})});if(l===1)return(0,e.jsx)(D.ZP,{children:(0,e.jsx)(E.Z,{type:"primary",onClick:function(){return Mt(u)},loading:fe,children:fe?"\u6B63\u5728\u5206\u6790":"\u5F00\u59CB\u5206\u6790"})});if(l===2)return(0,e.jsx)(D.ZP,{children:(0,e.jsx)(E.Z,{type:"primary",onClick:At,icon:(0,e.jsx)(Re.Z,{}),loading:ge,children:ge?"\u6B63\u5728\u4E0B\u8F7D":"\u8F85\u52A9\u8BCA\u7597\u62A5\u544A\u4E0B\u8F7D"},"download")})}},children:[(0,e.jsxs)(R.Z.StepForm,{name:"upload",title:"\u4E0A\u4F20\u5352\u4E2D\u5F71\u50CF",children:[(0,e.jsx)(Be.Z,{name:"date",width:"md",label:"\u5352\u4E2D\u5F71\u50CF\u68C0\u67E5\u65E5\u671F",initialValue:$()(),rules:[{required:!0}]}),(0,e.jsx)(g.Z,{children:"ADC\u5F71\u50CF\u4E0A\u4F20"}),(0,e.jsxs)(H,{label:"\u9009\u62E9ADC\u5F71\u50CF\u6587\u4EF6",name:"ADC",fileList:Z,max:1,onRemove:function(){return ee([])},beforeUpload:function(u){return Ae(u,"ADC")},children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(Q.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u9009\u62E9ADC\u5F71\u50CF"})]}),de&&(0,e.jsx)(c.Z,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},percent:Ne}),(0,e.jsx)(g.Z,{children:"DWI\u5F71\u50CF\u4E0A\u4F20"}),(0,e.jsx)(y.Z,{direction:"vertical"}),(0,e.jsxs)(H,{label:"\u9009\u62E9DWI\u5F71\u50CF\u6587\u4EF6",name:"DWI",fileList:L,onRemove:function(){return ae([])},beforeUpload:function(u){return Ae(u,"DWI")},max:1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(Q.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u9009\u62E9ADC\u5F71\u50CF"})]}),de&&(0,e.jsx)(c.Z,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},percent:Ye})]}),(0,e.jsxs)(R.Z.StepForm,{name:"analyze",title:"AI\u6A21\u578B\u9884\u6D4B",children:[(0,e.jsx)(D.ZP,{title:"ADC\u5F71\u50CF",headerBordered:!0,collapsible:!0,children:W(je)}),(0,e.jsx)(D.ZP,{title:"DWI\u5F71\u50CF",headerBordered:!0,collapsible:!0,children:W(Te)}),(0,e.jsx)("div",{children:"\u3010\u6A21\u578B\u8BA1\u7B97\u8FDB\u5EA6\u3011"}),(0,e.jsx)(c.Z,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},percent:pe})]}),(0,e.jsxs)(R.Z.StepForm,{name:"result",title:"\u7ED3\u679C\u67E5\u770B",children:[(0,e.jsx)(D.ZP,{title:"\u6897\u6B7B\u533A\u5206\u5272\u7ED3\u679C",headerBordered:!0,collapsible:!0,children:W(_t)}),(0,e.jsx)(D.ZP,{title:"\u6897\u6B7B\u533A\u53D1\u5C55\u9884\u6D4B",headerBordered:!0,collapsible:!0,children:W(dt)})]})]})})};I.default=Ze},75297:function(Oe,I,t){"use strict";t.d(I,{U:function(){return y}});var Ue=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(S){setTimeout(function(){S(!0)},c)})},y=function(c,S){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!c||typeof c!="object")return g;for(var B=S.replace(/\[/g,".").replace(/\]/g,"").split(".").filter(function(F){return F}),E=!0,m=c,C=0;C<B.length;C++){if(!m||Object.keys(m).indexOf(B[C])<0){E=!1;break}m=m[B[C]]}return E?m:g}}}]);
