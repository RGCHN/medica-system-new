(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[591],{16570:function(ge,U,t){"use strict";t.r(U);var Me=t(49111),W=t(19650),N=t(34669),_=t(32074),I=t(48736),P=t(27049),S=t(57663),p=t(71577),D=t(86582),C=t(12968),B=t(62462),gt=t(34792),E=t(48086),y=t(3182),n=t(2824),Mt=t(43185),Oe=t(11324),Ue=t(94043),v=t.n(Ue),r=t(67294),F=t(3843),Ie=t(45510),m=t(57895),Se=t(27484),V=t.n(Se),$=t(21010),Y=t(43642),Be=t(90631),w=t(43347),c=t(75297),G=t(64172),e=t(85893),Q=Oe.Z.Dragger,Fe=function(){var Re=(0,r.useState)([]),X=(0,n.Z)(Re,2),Ze=X[0],je=X[1],Le=(0,r.useState)([]),H=(0,n.Z)(Le,2),We=H[0],ye=H[1],Te=(0,r.useState)([]),J=(0,n.Z)(Te,2),R=J[0],k=J[1],be=(0,r.useState)([]),q=(0,n.Z)(be,2),Z=q[0],ee=q[1],Ke=(0,r.useState)(0),te=(0,n.Z)(Ke,2),xe=te[0],ze=te[1],Ne=(0,r.useState)(0),ae=(0,n.Z)(Ne,2),Ve=ae[0],$e=ae[1],Ye=(0,r.useState)(""),re=(0,n.Z)(Ye,2),we=re[0],Ge=re[1],Qe=(0,r.useState)(""),ue=(0,n.Z)(Qe,2),Xe=ue[0],He=ue[1],Je=(0,r.useState)(!1),se=(0,n.Z)(Je,2),ne=se[0],ke=se[1],qe=(0,r.useState)(0),le=(0,n.Z)(qe,2),Ut=le[0],et=le[1],tt=(0,r.useState)(""),de=(0,n.Z)(tt,2),It=de[0],at=de[1],rt=(0,r.useState)(!1),ie=(0,n.Z)(rt,2),oe=ie[0],T=ie[1],ut=(0,r.useState)(0),_e=(0,n.Z)(ut,2),ce=_e[0],b=_e[1],st=(0,r.useState)([]),fe=(0,n.Z)(st,2),nt=fe[0],lt=fe[1],dt=(0,r.useState)([]),De=(0,n.Z)(dt,2),it=De[0],ot=De[1],_t=(0,r.useState)(void 0),me=(0,n.Z)(_t,2),ct=me[0],ft=me[1],Dt=(0,r.useState)(!1),pe=(0,n.Z)(Dt,2),mt=pe[0],K=pe[1],pt=(0,r.useState)(!1),Ee=(0,n.Z)(pt,2),ve=Ee[0],x=Ee[1],z=(0,r.useRef)(),Pe=(0,r.useRef)(),A=(0,r.useRef)(void 0),j=(0,r.useRef)(0),Ce=(0,$.tT)("patient"),Et=Ce.getPatientID,vt=Ce.getPatientData,h=Et(),Ae=vt(),Pt=(0,r.useCallback)(function(){A.current||(A.current=setInterval(function(){ce<=98?(j.current=Math.floor((j.current+Math.random())*100)/100,b(j.current)):clearInterval(A.current)},1e3))},[]),Ct=function(){var o=(0,y.Z)(v().mark(function u(l){var s;return v().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b(0),j.current=0,T(!0),Pt(),a.prev=4,a.next=7,(0,G.Xh)({adc_file:we,backmodel:"0",dwi_file:Xe,patientID:h,timestamp:z.current});case 7:if(s=a.sent,A.current&&clearInterval(A.current),T(!1),b(100),T(!1),s.data.status!=="success"){a.next=22;break}return lt((0,c.U)(s,"data.data.nonperf_res_imgs",[])),ot((0,c.U)(s,"data.data.perf_res_imgs",[])),at((0,c.U)(s,"data.data.info","")),et((0,c.U)(s,"data.data.size",0)),ft((0,c.U)(s,"data.data.resultID",0)),l.onSubmit(),a.abrupt("return",!0);case 22:return E.default.error("\u7F51\u7EDC\u9519\u8BEF\uFF01"),a.abrupt("return",!1);case 24:a.next=31;break;case 26:return a.prev=26,a.t0=a.catch(4),E.default.error("\u7F51\u7EDC\u9519\u8BEF\uFF01"),console.log(a.t0),a.abrupt("return",!1);case 31:case"end":return a.stop()}},u,null,[[4,26]])}));return function(l){return o.apply(this,arguments)}}(),L=function(u){if(u.length!==0)return(0,e.jsx)(B.Z.PreviewGroup,{children:u.map(function(l,s){return(0,e.jsx)(B.Z,{src:l,alt:"",height:"160px",width:"160px"},s)})})},he=function(u,l){return l==="ADC"&&k([].concat((0,D.Z)(R),[u])),l==="DWI"&&ee([].concat((0,D.Z)(Z),[u])),!1},At=function(){var o=(0,y.Z)(v().mark(function u(l){var s,f,a,g,d;return v().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return ke(!0),K(!0),z.current=Pe.current.getFieldValue("date").valueOf(),s=new FormData,R.forEach(function(M){s.append("file",M),s.append("patientID",h),s.append("type","ADC")}),f=new FormData,Z.forEach(function(M){f.append("file",M),f.append("patientID",h),f.append("type","DWI")}),i.prev=7,i.next=10,Promise.all([Y.$.post("/imgUpload",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(O){ze(O.loaded/O.total*100|0)}}),Y.$.post("/imgUpload",f,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(O){$e(O.loaded/O.total*100|0)}})]);case 10:if(a=i.sent,g=a[0],d=a[1],!(g.data.status==="success"&&d.data.status==="success")){i.next=24;break}return je((0,c.U)(g,"data.data.imgs",[])),Ge((0,c.U)(g,"data.data.filename",[])),ye((0,c.U)(d,"data.data.imgs",[])),He((0,c.U)(d,"data.data.filename",[])),E.default.success("\u4E0A\u4F20\u6210\u529F\uFF01"),K(!1),l.onSubmit(),i.abrupt("return",!0);case 24:return E.default.error("\u7F51\u7EDC\u9519\u8BEF\uFF01\u8BF7\u7A0D\u540E\u91CD\u8BD5\uFF01"),K(!1),i.abrupt("return",!1);case 27:i.next=34;break;case 29:return i.prev=29,i.t0=i.catch(7),console.log(i.t0),E.default.error("\u7F51\u7EDC\u9519\u8BEF\uFF01\u8BF7\u7A0D\u540E\u91CD\u8BD5\uFF01"),i.abrupt("return",!1);case 34:case"end":return i.stop()}},u,null,[[7,29]])}));return function(l){return o.apply(this,arguments)}}(),ht=function(){var o=(0,y.Z)(v().mark(function u(){var l,s,f,a;return v().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return x(!0),d.prev=1,d.next=4,(0,G.QL)({resultID:ct});case 4:l=d.sent,s=new Blob([l.data],{type:"application/pdf"}),f=URL.createObjectURL(s),a=document.createElement("a"),a.style.display="none",a.href=f,a.download="\u8F85\u52A9\u8BCA\u65AD\u62A5\u544A-".concat(Ae.name,"-").concat(V()(z.current).format("YYYY-MM-DD")),document.body.appendChild(a),a.click(),document.body.removeChild(a),x(!1),d.next=22;break;case 17:d.prev=17,d.t0=d.catch(1),x(!1),E.default.error("\u53D1\u751F\u9519\u8BEF\uFF01\u8BF7\u7A0D\u540E\u91CD\u8BD5"),console.log(d.t0);case 22:case"end":return d.stop()}},u,null,[[1,17]])}));return function(){return o.apply(this,arguments)}}();return(0,r.useEffect)(function(){h||$.m8.push("/list")},[h]),(0,e.jsx)(m.ZP,{title:"\u65B0\u5EFA\u6A21\u578B\u9884\u6D4B",extra:"\u5F53\u524D\u75C5\u4EBA:  ".concat(Ae.name),children:(0,e.jsxs)(F.Z,{formRef:Pe,formProps:{validateMessages:{required:"\u6B64\u9879\u4E3A\u5FC5\u586B\u9879"}},submitter:{render:function(u){var l=u.step;if(l===0)return(0,e.jsx)(m.ZP,{children:(0,e.jsx)(p.Z,{type:"primary",onClick:function(){return At(u)},disabled:R.length!==1||Z.length!==1,loading:mt,children:"\u4E0A\u4F20\u6570\u636E"})});if(l===1)return(0,e.jsx)(m.ZP,{children:(0,e.jsx)(p.Z,{type:"primary",onClick:function(){return Ct(u)},loading:oe,children:oe?"\u6B63\u5728\u5206\u5272":"\u5F00\u59CB\u5206\u5272"})});if(l===2)return(0,e.jsx)(m.ZP,{children:(0,e.jsx)(p.Z,{type:"primary",onClick:ht,icon:(0,e.jsx)(Be.Z,{}),loading:ve,children:ve?"\u6B63\u5728\u4E0B\u8F7D":"\u8F85\u52A9\u8BCA\u7597\u62A5\u544A\u4E0B\u8F7D"},"download")})}},children:[(0,e.jsxs)(F.Z.StepForm,{name:"upload",title:"\u4E0A\u4F20\u5352\u4E2D\u5F71\u50CF",children:[(0,e.jsx)(Ie.Z,{name:"date",width:"md",label:"\u5352\u4E2D\u5F71\u50CF\u68C0\u67E5\u65E5\u671F",initialValue:V()(),rules:[{required:!0}]}),(0,e.jsx)(P.Z,{children:"ADC\u5F71\u50CF\u4E0A\u4F20"}),(0,e.jsxs)(Q,{label:"\u9009\u62E9ADC\u5F71\u50CF\u6587\u4EF6",name:"ADC",fileList:R,max:1,onRemove:function(){return k([])},beforeUpload:function(u){return he(u,"ADC")},children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(w.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u9009\u62E9ADC\u5F71\u50CF"})]}),ne&&(0,e.jsx)(_.Z,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},percent:xe}),(0,e.jsx)(P.Z,{children:"DWI\u5F71\u50CF\u4E0A\u4F20"}),(0,e.jsx)(W.Z,{direction:"vertical"}),(0,e.jsxs)(Q,{label:"\u9009\u62E9DWI\u5F71\u50CF\u6587\u4EF6",name:"DWI",fileList:Z,onRemove:function(){return ee([])},beforeUpload:function(u){return he(u,"DWI")},max:1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(w.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u9009\u62E9ADC\u5F71\u50CF"})]}),ne&&(0,e.jsx)(_.Z,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},percent:Ve})]}),(0,e.jsxs)(F.Z.StepForm,{name:"analyze",title:"AI\u6A21\u578B\u9884\u6D4B",children:[(0,e.jsx)(m.ZP,{title:"ADC\u5F71\u50CF",headerBordered:!0,collapsible:!0,children:L(Ze)}),(0,e.jsx)(m.ZP,{title:"DWI\u5F71\u50CF",headerBordered:!0,collapsible:!0,children:L(We)}),(0,e.jsx)("div",{children:"\u3010\u6A21\u578B\u5206\u5272\u8FDB\u5EA6\u3011"}),(0,e.jsx)(_.Z,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},percent:ce})]}),(0,e.jsxs)(F.Z.StepForm,{name:"result",title:"\u7ED3\u679C\u67E5\u770B",children:[(0,e.jsx)(m.ZP,{title:"\u8840\u7BA1\u518D\u901A\u6700\u7EC8\u6897\u6B7B\u533A\u9884\u6D4B",headerBordered:!0,collapsible:!0,children:L(it)}),(0,e.jsx)(m.ZP,{title:"\u8840\u7BA1\u672A\u518D\u901A\u6897\u6B7B\u533A\u9884\u6D4B",headerBordered:!0,collapsible:!0,children:L(nt)})]})]})})};U.default=Fe},75297:function(ge,U,t){"use strict";t.d(U,{U:function(){return W}});var Me=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(I){setTimeout(function(){I(!0)},_)})},W=function(_,I){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!_||typeof _!="object")return P;for(var S=I.replace(/\[/g,".").replace(/\]/g,"").split(".").filter(function(B){return B}),p=!0,D=_,C=0;C<S.length;C++){if(!D||Object.keys(D).indexOf(S[C])<0){p=!1;break}D=D[S[C]]}return p?D:P}}}]);
